在文字修仙游戏中，NPC是提供“江湖味”的关键。如果NPC全是枯燥的数据桩，游戏就是单机刷怪；如果NPC有性格、有故事、有社交链，游戏就有了**“修真社会学”**。

为了配合《万古墨境》的“红尘渡”主题，我将NPC生成逻辑设计为**“骨相（数值）+ 皮相（描述）+ 命相（性格与关系）”**的三层架构。

---

# NPC 随机生成系统设计方案

## 1. 生成入口参数 (Seed Input)
后端在生成NPC时，通常基于以下几个上下文参数：
*   **Location (地点):** 决定了NPC的平均境界和属性（如：火焰山多火修）。
*   **Level_Range (境界范围):** 决定了强弱。
*   **Role_Type (身份模板):** 散修、宗门弟子、魔修、富二代、乞丐。

---

## 2. 第一层：皮相系统 (Appearance & Identity)
*负责生成NPC的名字、外貌和基础标签，决定玩家对他的第一印象。*

### A. 姓名生成 (Name Gen)
建立三个字库：
1.  **姓氏库：** 赵、钱、孙、李、独孤、慕容、轩辕...
2.  **男名库：** 凡、尘、风、云、霸、天、墨、渊... (偏硬朗/玄幻)
3.  **女名库：** 灵、儿、雪、月、瑶、姬、紫、烟... (偏唯美)

**特殊逻辑：**
*   **道号生成（金丹期以上）：** `[形容词] + [名词] + 散人/真君/老祖`。
    *   *例：* 青木散人、血手老祖。

### B. 外貌描述生成 (Description Gen)
采用**标签拼接法**，生成一段纯文本描述。
公式：`[体型] + [穿着] + [面部特征] + [气质]`

| 维度 | 标签库示例 |
| :--- | :--- |
| **体型** | 身材魁梧的、瘦骨嶙峋的、大腹便便的、身姿曼妙的 |
| **穿着** | 身穿青云宗道袍、披着破旧麻衣、身披兽皮战甲、锦衣华服 |
| **五官** | 剑眉星目、贼眉鼠眼、面若桃花、独眼龙、满脸横肉 |
| **气质** | 周身散发着寒气、眼神阴鸷、笑眯眯的、一脸正气 |

*   **生成结果：** *“一个身材魁梧的壮汉，身披兽皮战甲，满脸横肉，周身散发着杀气。”*

---

## 3. 第二层：骨相系统 (Stats & Cultivation)
*负责生成NPC的战斗力和资源。*

### A. 境界与年龄 (Realm & Age)
年龄必须符合境界，否则会有违和感（除非是天才流或夺舍流）。

| 境界 | 年龄随机范围 | 备注 |
| :--- | :--- | :--- |
| **炼气** | 14 ~ 60 岁 | 超过60岁还是炼气，判定为“老朽/潜力耗尽” |
| **筑基** | 30 ~ 150 岁 | 中坚力量 |
| **金丹** | 100 ~ 400 岁 | 驻颜有术，看起来可能像青年 |
| **元婴** | 300 ~ 900 岁 | 老怪 |

### B. 性格与AI逻辑 (Personality - Big 5 of Xianxia)
这是NPC“活”起来的关键。我们用**3个核心轴**来定义NPC的行为模式。

1.  **正邪轴 (Alignment):**
    *   **正道 (Righteous):** 倾向于交易、论道。被攻击会记仇。
    *   **魔道 (Demonic):** 倾向于杀人夺宝。你血量低时他大概率偷袭。
    *   **中立/唯利 (Neutral):** 只要给钱什么都干。

2.  **胆识轴 (Bravery):**
    *   **鲁莽 (Rash):** 哪怕你境界比他高，他也敢骂你（通常是富二代）。
    *   **谨慎 (Cautious):** 只要你装备比他好，他看见你就跑。
    *   **阴险 (Insidious):** 表面求饶，等你背身时发起攻击。

3.  **人际轴 (Social):**
    *   **孤僻 (Loner):** 散修，死了没人管。
    *   **护短 (Protective):** 宗门/家族。打了小的来老的（P2阶段核心）。

### C. 资源生成 (Inventory)
根据NPC的【境界】+【身份】生成。
*   **散修：** 灵石少，草药多，装备破烂（耐久低）。
*   **宗门弟子：** 灵石中等，有制式装备，必定携带【宗门令牌】。
*   **富二代（肥羊）：** 大量灵石，高阶法宝，大概率有【保命护符】。

---

## 4. 第三层：模板与剧本 (Archetypes)
*为了让随机更有趣，我们预设几种“经典修仙人设”进行加权随机。*

### 模板 1：【落魄废柴】(The Trash)
*   **特征：** 境界低，但戒指里可能有老爷爷（极低概率掉落高阶功法）。
*   **性格：** 坚韧，你羞辱他，他会说“三十年河东”。
*   **交互：** 如果你资助他，几百年后他可能成为大佬回报你。

### 模板 2：【纨绔子弟】(Young Master)
*   **特征：** 境界一般，装备极好。
*   **性格：** 鲁莽 + 护短。
*   **对话：** “你知道我爹是谁吗？”
*   **后果：** 杀了他，必掉好东西，但**100%触发“打了小的来老的”事件**（生成一个高境界的爹追杀你）。

### 模板 3：【隐世高人】(Hidden Expert)
*   **特征：** 显示境界为“炼气期”（伪装），但实际属性是“化神期”。
*   **外貌：** 扫地僧、卖糖葫芦的老头。
*   **交互：** 如果你试图打劫他，会被一招秒杀。如果你对他恭敬（送礼/论道），可能触发机缘。

### 模板 4：【杀人狂魔】(The Hunter)
*   **特征：** 红名，名字血红。
*   **行为：** 在地图上会自动向玩家坐标移动。
*   **掉落：** 他的背包里有大量其他修士的遗物（盲盒）。

---

## 5. 生成逻辑的代码结构 (Pseudo-Code)

```python
class NPCGenerator:
    def generate_npc(self, target_realm, map_type):
        npc = NPC()
        
        # 1. 掷骰子决定人设模板
        roll = random.random()
        if roll < 0.05:
            archetype = "Young_Master" # 纨绔子弟
        elif roll < 0.01:
            archetype = "Hidden_Expert" # 隐世高人
        else:
            archetype = "Common_Cultivator" # 普通路人

        # 2. 生成基础皮相
        npc.name = self.random_name(gender=random.choice(['M', 'F']))
        npc.desc = self.generate_description(archetype)
        
        # 3. 生成数值
        if archetype == "Hidden_Expert":
            npc.display_realm = "炼气期"
            npc.real_realm = "化神期"
            npc.stats = self.get_stats_by_realm("化神期")
        else:
            npc.display_realm = target_realm
            npc.real_realm = target_realm
            npc.stats = self.get_stats_by_realm(target_realm)
            
        # 4. 生成性格 (Tag System)
        if archetype == "Young_Master":
            npc.tags = ["Arrogant", "Rich", "Has_Parent"]
            npc.inventory = self.generate_loot(quality="High")
        else:
            npc.tags = self.random_personality()
            npc.inventory = self.generate_loot(quality="Normal")
            
        # 5. 生成社交链 (P2阶段)
        if "Has_Parent" in npc.tags:
            npc.parent_id = self.create_virtual_npc("元婴期老怪")
            
        return npc
```

---

## 6. NPC 的“生命周期” (Lifecycle)

NPC不应该只是等着被玩家杀，他们也要“修仙”。

1.  **移动与升级：**
    *   系统每隔一段时间（如游戏内1年），会对活跃NPC进行结算。
    *   他们可能会升级、可能会在争斗中死亡、可能会捡到宝物。
    *   *日志：* “你的好友[李二狗]在蛮荒之地获得了大机缘，突破至金丹期！”

2.  **交互反馈：**
    *   **论道：** 双方比拼“悟性”和“道心”。赢了加经验，输了掉心境。
    *   **交易：** 类似于“以物易物”。NPC会根据自己的需求（比如他是火修，他只收火属性材料）来决定是否交换。
    *   **双修：** 好感度达到“知己”，且性别/性取向匹配。可以结为道侣，共享洞府加成。

## 7. 给开发者的建议

*   **数据库：** NPC数据量大，但大部分是“临时演员”。建议只把**与玩家发生过交互（说话/战斗/送礼）**的NPC持久化存储，其他的路人甲在玩家离开地图后直接销毁，下次再随机生成新的。
*   **对话库：** 这是一个文字游戏，NPC的灵魂在于**话多**。
    *   *见面（正道）：* “这位道友，相逢即是缘。”
    *   *见面（魔道）：* “桀桀桀，又来一个送死的。”
    *   *求饶：* “道友饶命！我愿献上储物袋！”
    *   *逃跑：* “青山不改，绿水长流，我们走着瞧！”

通过这套逻辑，你生成的不是一个个怪，而是一个**“江湖”**。