# 万古墨境：红尘渡 (WanGu: The Mortal Passage)

[![Flutter](https://img.shields.io/badge/Flutter-3.x-blue.svg)](https://flutter.dev)
[![Dart](https://img.shields.io/badge/Dart-3.x-blue.svg)](https://dart.dev)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

一个基于 Flutter 开发的文字修仙 MUD 游戏。
在这个世界里，你将扮演一名初入修真界的散修，通过探索、战斗、修炼，一步步从凡人蜕变为渡劫飞升的仙人。

## 🌟 游戏特色

### 1. 沉浸式文字体验
*   **纯粹的文字冒险**：摒弃繁杂的 3D 画面，回归文字 MUD 的本真，用想象力构建你的修仙世界。
*   **动态日志系统**：每一场战斗、每一次奇遇都有详细的文字记录，记录你的修仙生平。

### 2. 深度探索系统
*   **迷雾地图**：采用网格化地图探索机制，未探索区域被迷雾覆盖，每一步都充满未知。
*   **多样化地形**：宗门、竹林、溪谷、洞穴、遗迹...不同的地形孕育着不同的机缘与危险。
*   **随机事件**：行走江湖，可能偶遇前辈高人，也可能误入妖兽巢穴，全看机缘。

### 3. 策略战斗
*   **回合制战斗**：基于速度的回合制战斗系统，考验你的属性搭配。
*   **五行生克**：金木水火土五行相克，属性压制可造成 1.5 倍伤害，被克制则伤害减半。
*   **武器法术**：特定的法宝附带强力法术，消耗灵力即可释放，拥有无视防御等特殊效果。
*   **可视化战报**：战斗过程实时反馈，暴击、闪避、技能释放、属性克制一目了然。
*   **多样化敌人**：从狂暴野猪到赤炎虎王，每种敌人都有独特的五行属性和掉落。

### 4. 社交与 NPC
*   **鲜活的 NPC**：每个 NPC 都有自己的性格、身份和对话。
*   **互动系统**：你可以与 NPC 交谈获取情报，甚至（如果你足够大胆）对他们发起攻击。
*   **关系网**：你的行为会影响 NPC 对你的态度（开发中）。

### 5. 核心机制：浊气与灵气 (New!)
*   **博弈循环**：修仙本是逆天而行。纳气修炼虽然能快速提升修为，但也会吸入天地浊气（毒素）。
*   **纯度决定生死**：灵气纯度直接影响突破成功率。纯度太低强行突破，轻则修为倒退，重则身死道消。
*   **多样化选择**：是选择"静坐修炼"稳扎稳打，还是"深度闭关"追求速度？是花费时间"运功排毒"，还是寻找灵丹妙药洗髓伐骨？

### 6. 修炼与成长
*   **境界体系**：还原经典的修仙境界（炼气、筑基...），每个大境界包含 10 个小境界（层）。
*   **突破挑战**：小境界突破相对容易，大境界突破则需要天时地利人和（特定道具、极高纯度）。
*   **属性养成**：气血、神识、攻击、防御、身法、悟性，六大维度自由发展。

### 7. 突破失败惩罚机制 (New!)
*   **代价高昂**：突破不再是简单的“成功或重试”。失败将带来实质性的后果，根据纯度和运气决定惩罚等级。
*   **肉身异变**：可能遭受雷劫导致**肢体残缺**（攻击下降）、**五感尽失**（神识受损）、甚至血脉逆行导致**半妖化**（属性剧变）。
*   **命运转折**：可能**阴阳逆转**（性别改变）、**虚空流放**（传送至高危区域）、或者遭遇**仇家锁定**（即时战斗）。
*   **资源危机**：可能导致**储物袋炸裂**（物品丢失）、**本命法宝反噬**（失去武器）、甚至**道侣断义**（精神重创）。

### 8. 背包与物品系统 (Updated!)
*   **物品堆叠**：相同的材料和消耗品现在会自动堆叠，节省背包空间 (New!)。
*   **装备系统重构**：全新的 6 槽位装备系统（本命/主手/护身/饰品/护卫/坐骑），支持更丰富的装备搭配策略。
*   **网格化管理**：全新的 5 列网格布局，物品稀有度通过边框颜色直观展示（灰/绿/蓝/紫/金/红）。
*   **海量存储**：支持分页显示（每页 50 个物品），从此告别背包焦虑。
*   **储物法宝**：实装储物袋系统，装备不同等级的储物袋（如乾坤袋、纳戒）可动态扩充背包容量（装备于饰品或坐骑位）。
*   **智能整理**：一键自动整理背包，按稀有度、类型、等级自动排序。

### 9. 任务系统 (New!)
*   **宗门任务堂**：在宗门接取各类委托，赚取贡献与资源。
*   **多样化任务**：
    *   **收集任务**：搜集特定的灵草、矿石或妖兽材料。
    *   **讨伐任务**：前往危险区域猎杀指定的妖兽或敌人。
*   **自动追踪**：任务进度自动更新，无论是采集物品还是击败敌人，系统都会实时记录。
*   **奖励机制**：完成任务可获得宗门贡献、修为经验以及丹药灵石等实物奖励。
*   **数据持久化**：已接取的任务进度会随存档保存，随时随地继续你的修仙之旅。

### 10. 五行战斗系统 (New!)
*   **Buff与状态系统**：支持正面/负面/混合类型的状态效果，实时影响角色属性（New!）。
*   **数据持久化**：支持随时保存和读取游戏进度，本地存储，离线可玩。
*   **自动存档**：在关键事件（战斗、突破、移动等）后自动保存，防止意外退出导致进度丢失。
*   **时间流逝**：真实的修仙岁月，每一次移动、修炼、战斗都会消耗时间，寿元倒计时时刻提醒你大道的紧迫。
*   **多主题支持**：内置明亮/暗黑主题，可跟随系统或手动切换，保护你的视力。
*   **完备的设置**：重置游戏、清除存档、关于游戏等功能一应俱全。

### 10. 五行战斗系统 (New!)
*   **五行循环**：引入金、木、水、火、土五行生克机制 (金克木>木克土>土克水>水克火>火克金)。
*   **策略博弈**：针对敌人的属性选择合适的武器（攻击克制）和防具（防御克制），是克敌制胜的关键。
*   **法术爆发**：不再局限于普通攻击。装备附带法术的法宝后，可消耗灵力释放强力技能，给予敌人毁灭性打击。
*   **动态交互**：战斗界面新增五行属性显示与动态施法按钮，战局信息一手掌握。

### 11. 命格系统 (New!)
*   **多样化开局**：在创建角色时可选择不同的命格（如穿越者、伴生异火、天生神力等），决定角色的初始资质和特殊能力。
*   **动态效果**：不同的命格会带来不同的被动加成（属性提升、修炼速度、事件概率等），甚至改变游戏玩法（如“独臂大侠”无法装备副手）。
*   **云端同步**：命格数据支持从服务器动态获取，确保游戏内容的实时更新与平衡性调整。
*   **可视化展示**：在属性面板直观展示当前拥有的命格及其详细效果。

### 12. 后端集成与云存档 (New!)
*   **账号系统**：支持用户注册与登录，保障数据安全。
*   **云存档**：关键进度自动同步至云端，支持多设备无缝切换游玩。
*   **动态数据**：游戏配置（如命格、物品定义）可由服务器下发，无需更新客户端即可体验新内容。

## 🛠️ 技术栈

*   **框架**: Flutter (Dart)
*   **状态管理**: Provider
*   **数据存储**: shared_preferences
*   **动画**: flutter_animate
*   **架构**: MVVM (Model-View-ViewModel) / Repository Pattern
*   **图标**: Material Design Icons

## 📂 项目结构

```
lib/
├── src/
│   ├── data/           # 数据仓库 (Repositories)
│   │   ├── enemies/            # 敌人数据定义 (分文件管理)
│   │   ├── items/              # 物品数据定义 (分文件管理)
│   │   ├── buffs_repository.dart       # Buff数据定义
│   │   ├── drop_tables.dart            # 全局掉落表
│   │   ├── punishments_repository.dart # 惩罚逻辑
│   │   ├── items_repository.dart       # 物品数据
│   │   ├── enemies_repository.dart     # 敌人数据
│   │   ├── maps_repository.dart        # 地图数据
│   │   └── npcs_repository.dart        # NPC数据
│   ├── models/         # 数据模型 (Models)
│   │   ├── battle.dart         # 战斗实例模型
│   │   ├── player.dart         # 玩家核心模型
│   │   ├── buff.dart           # Buff模型
│   │   ├── stats.dart          # 属性模型
│   │   ├── realm_stage.dart    # 境界模型
│   │   ├── enemy.dart          # 敌人模型
│   │   ├── item.dart           # 物品模型
│   │   ├── map_node.dart       # 地图节点
│   │   ├── npc.dart            # NPC模型
│   │   ├── world_clock.dart    # 世界时间
│   ├── services/       # 服务层 (Services)
│   │   ├── api_service.dart    # 后端 API 交互
│   │   └── npc_generator.dart  # NPC 生成服务
│   ├── state/          # 状态管理 (Providers)
│   │   ├── game_state.dart     # 核心游戏状态容器
│   │   ├── game_state_parts/   # 游戏逻辑模块 (Inventory, Battle, Cultivation, etc.)
│   │   └── settings_state.dart # 设置状态
│   ├── ui/             # 界面 (Views)
    │   │   ├── home/
    │   │   │   ├── sections/   # 主要功能区 (Map, Inventory, Stats, Cultivate, Sect)
    │   │   │   └── widgets/    # 通用组件 (BattleOverlay, BreakthroughOverlay, StatCards, etc.)
    │   │   ├── settings/       # 设置界面
    │   │   ├── sect/           # 宗门界面 (Mission Hall)
    │   │   └── theme/          # 主题定义
    │   └── utils/          # 工具类
    │       └── element_logic.dart  # 五行生克逻辑
└── main.dart           # 入口文件
```

## 🚀 快速开始

1.  **环境准备**：确保已安装 Flutter SDK (推荐 3.10+)。
2.  **克隆项目**：
    ```bash
    git clone https://github.com/your-username/WanGu.git
    cd WanGu
    ```
3.  **安装依赖**：
    ```bash
    flutter pub get
    ```
4.  **运行游戏**：
    ```bash
    flutter run
    ```

## 📅 开发路线图 (Roadmap)

- [x] **P0: 基础框架**
    - [x] 角色创建与基础属性
    - [x] 物品背包系统 (Grid Layout + Pagination)
    - [x] 基础地图探索 (Grid + Fog of War)
    - [x] 基础战斗系统 (1v1)
    - [x] 本地存档与设置系统
    - [x] 自动存档与时间流逝机制
    - [x] 模块化状态管理 (GameState Refactoring)

- [x] **P0: 社交与 NPC**
    - [x] NPC 数据模型与仓库
    - [x] 地图 NPC 展示 (Avatar Bar)
    - [x] NPC 交互弹窗 (交谈/查看/攻击)

- [x] **P1: 核心机制 (Current Focus)**
    - [x] 境界体系细化 (10层/阶)
    - [x] 浊气与灵气系统 (Risk/Reward)
    - [x] 突破动画与视觉反馈
    - [x] 基础修炼循环 (修炼/排毒)
    - [x] **Buff与状态系统 (正面/负面/混合)**
    - [x] **突破失败惩罚实装 (残疾/变身/降维)**
    - [x] **高级背包功能 (储物袋扩容/一键整理/空槽位显示)**
    - [x] **装备系统重构 (6槽位)**
    - [x] **战斗逃跑机制 (基于速度差)**
    - [x] **智能掉落系统 (稀有度权重)**
    - [x] **命格系统 (前后端集成)**
    - [x] **数据云端同步 (Traits/Saves)**

- [ ] **P2: 进阶玩法**
    - [ ] 功法与技能系统
    - [ ] 装备强化与词条
    - [ ] 宗门设施建设 (炼丹房/炼器室)
    - [ ] 更多随机事件

- [ ] **P3: 活着的修仙界**
    - [ ] NPC 关系网与动态复仇
    - [ ] 世界传闻系统
    - [ ] 化凡历练玩法

## 🤝 贡献指南

欢迎任何形式的贡献！无论是提交 Bug、建议新功能，还是直接提交代码 (PR)。

1.  Fork 本仓库
2.  创建你的特性分支 (`git checkout -b feature/AmazingFeature`)
3.  提交你的修改 (`git commit -m 'Add some AmazingFeature'`)
4.  推送到分支 (`git push origin feature/AmazingFeature`)
5.  开启一个 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 详情请见 [LICENSE](LICENSE) 文件。
